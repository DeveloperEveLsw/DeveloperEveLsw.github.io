<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steam í”„ë¡œí•„ ë·°ì–´</title>
    <style>
        :root { 
            --steam-bg-dark: #1b2838;
            --steam-bg-darker: #171a21;
            --steam-bg-light: #2a3f5a;
            --steam-blue: #1a9fff;
            --steam-blue-hover: #66c0f4;
            --steam-text: #c7d5e0;
            --steam-text-bright: #ffffff;
            --steam-green: #5c7e10;
            --steam-card-bg: rgba(42, 63, 90, 0.7);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, Helvetica, sans-serif;
        }

        body {
            background-color: var(--steam-bg-dark);
            color: var(--steam-text);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background-color: var(--steam-bg-darker);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.3);
        }

        .logo {
            color: var(--steam-text-bright);
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        .logo-icon {
            margin-right: 10px;
            font-size: 28px;
        }

        /* Main Content */
        .main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            position: relative;
        }

        .setting-box {
            position: absolute; /* ë¶€ëª¨ ê¸°ì¤€ìœ¼ë¡œ ìœ„ì¹˜ ì„¤ì • */
            top: 10px; /* ìƒë‹¨ì—ì„œ 10px ë–¨ì–´ì§ */
            right: 15px; /* ìš°ì¸¡ì—ì„œ 15px ë–¨ì–´ì§ */
        }

        .search-container {
            width: 100%;
            max-width: 600px;
            margin-bottom: 40px;
            text-align: center;
        }

        .search-title {
            color: var(--steam-text-bright);
            font-size: 28px;
            margin-bottom: 20px;
        }

        .search-description {
            color: var(--steam-text);
            margin-bottom: 25px;
            font-size: 16px;
        }

        .search-form {
            display: flex;
            width: 100%;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .search-input {
            flex: 1;
            padding: 15px;
            font-size: 16px;
            border: none;
            background-color: rgba(0, 0, 0, 0.2);
            color: var(--steam-text-bright);
            border: 1px solid var(--steam-bg-light);
            border-right: none;
            border-radius: 4px 0 0 4px;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--steam-blue);
        }

        .search-button {
            background-color: var(--steam-blue);
            color: var(--steam-text-bright);
            border: none;
            padding: 0 25px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s;
            border-radius: 0 4px 4px 0;
        }

        .search-button:hover {
            background-color: var(--steam-blue-hover);
        }

        /* Results Container */
        .results-container {
            width: 100%;
            display: none; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
        }

        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            background-color: var(--steam-card-bg);
            padding: 20px;
            border-radius: 4px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 4px;
            margin-right: 20px;
            background-color: var(--steam-bg-light);
            background-size: cover;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            color: var(--steam-text-bright);
            font-size: 24px;
            margin-bottom: 5px;
        }

        .profile-stats {
            display: flex;
            gap: 20px;
            font-size: 14px;
        }

        .profile-stat {
            display: flex;
            flex-direction: column;
        }

        .stat-value {
            color: var(--steam-blue);
            font-weight: bold;
        }

        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            width: 100%;
        }

        .card {
            background-color: var(--steam-card-bg);
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            background-color: var(--steam-bg-darker);
            padding: 12px 15px;
            color: var(--steam-text-bright);
            font-size: 16px;
            font-weight: bold;
            border-bottom: 1px solid var(--steam-bg-light);
        }

        .card-content {
            padding: 15px;
        }

        .game-item {
            display: flex;
            margin-bottom: 15px;
            align-items: center;
        }

        .game-item:last-child {
            margin-bottom: 0;
        }

        .game-image {
            width: 60px;
            height: 60px;
            background-color: var(--steam-bg-light);
            margin-right: 15px;
            border-radius: 3px;
            background-size: cover;
            background-position: center;
        }

        .game-details {
            flex: 1;
        }

        .game-title {
            color: var(--steam-text-bright);
            font-size: 14px;
            margin-bottom: 5px;
        }

        .game-stats {
            font-size: 12px;
            color: var(--steam-text);
        }

        .hours-played {
            color: var(--steam-blue);
        }

        .total-amount {
            margin-bottom: 10px;
        }

        .achievement {
            display: flex;
            margin-bottom: 15px;
            align-items: center;
        }

        .achievement:last-child {
            margin-bottom: 0;
        }

        .achievement-icon {
            width: 50px;
            height: 50px;
            background-color: var(--steam-bg-light);
            margin-right: 15px;
            border-radius: 3px;
            background-size: cover;
            background-position: center;
        }

        .achievement-details {
            flex: 1;
        }

        .achievement-title {
            color: var(--steam-text-bright);
            font-size: 14px;
            margin-bottom: 5px;
        }

        .achievement-date {
            font-size: 12px;
            color: var(--steam-text);
        }

        .loading {
            display: none;
            text-align: center;
            margin: 30px 0;
        }

        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--steam-blue);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            color: #e74c3c;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background-color: rgba(231, 76, 60, 0.1);
            border-radius: 4px;
            display: none;
        }

        .message {
            color: var(--steam-text);
            font-size: small;
            text-align: center;
            margin: 20px auto;
            padding: 15px;
            background-color: rgba(75, 75, 75, 0.1);
            border-radius: 4px;
            display: none;
            width: 400px;
        }

        .settings-btn {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(71, 85, 105, 0.5);
            color: #cbd5e1;
            padding: 0.5rem;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(4px);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            font-size: 0.875rem;
        }

        .settings-btn:hover {
            background: rgba(51, 65, 85, 0.7);
            border-color: rgba(71, 85, 105, 1);
            color: white;
            transform: translateY(-1px);
        }

        .settings-btn.icon-only {
            width: 2.5rem;
            height: 2.5rem;
        }

        /* Footer */
        .footer {
            background-color: var(--steam-bg-darker);
            padding: 15px 20px;
            text-align: center;
            font-size: 12px;
            color: var(--steam-text);
            margin-top: auto;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .search-container {
                padding: 0 15px;
            }
            
            .cards-grid {
                grid-template-columns: 1fr;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .profile-avatar {
                margin-right: 0;
                margin-bottom: 15px;
            }
            
            .profile-stats {
                justify-content: center;
                flex-wrap: wrap;
            }
        }
    </style>
    <link rel="stylesheet" href="apiKeyModal.css">
</head>
<body>
    <header class="header">
        <div class="logo">
            <span class="logo-icon">ğŸ®</span>
            <span>STEAM í”„ë¡œí•„ ë·°ì–´</span>
        </div>
    </header>

    <main class="main-container">
        <div class="setting-box">
            <button class="settings-btn icon-only" onclick="openApiKeyModal()">
                <svg class="gear-icon" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97 0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1 0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"/>
                </svg>
            </button>
        </div>
        <div class="search-container">
            <h1 class="search-title">Steam í”„ë¡œí•„ ê²€ìƒ‰</h1>
            <p class="search-description">Steam Idì„ ì…ë ¥í•˜ì—¬ ê²Œì„ í†µê³„, ë„ì „ê³¼ì œ ë“±ì˜ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.
                <br>
                Steam Id ëŠ” 17ìë¦¬ ì •ìˆ˜ë¡œ ëœ ê³ ìœ  Id ì…ë‹ˆë‹¤. ê³„ì • ê´€ë¦¬ì—ì„œ í™•ì¸ê°€ëŠ¥
                <br>ex) 76561198181739210
            </p>

            <form class="search-form" id="search-form">
                <input type="text" class="search-input" id="steam-id" placeholder="Steam ì‚¬ìš©ìëª… ë˜ëŠ” ID ì…ë ¥..." required>
                <button type="submit" class="search-button">ê²€ìƒ‰</button>
            </form>
            
            <div class="message" id="message">
                í”„ë¡œí•„ ì •ë³´ê°€ ê³µê°œê°€ ì•„ë‹ˆì—¬ì„œ ì¼ë¶€ ì •ë³´ëŠ” ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤
            </div>


        </div>

        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>

        <div class="error-message" id="error-message">
            ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ í”„ë¡œí•„ì´ ë¹„ê³µê°œì…ë‹ˆë‹¤. ë‹¤ë¥¸ ì‚¬ìš©ìëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
        </div>

        <div class="results-container" id="results-container">
            <div class="profile-header" id="profile-header">
                <div class="profile-avatar" id="profile-avatar"></div>
                <div class="profile-info">
                    <h2 class="profile-name" id="profile-name">ì‚¬ìš©ìëª…</h2>
                    <div class="profile-stats">
                        <div class="profile-stat">
                            <span>ê²Œì„ ìˆ˜</span>
                            <span class="stat-value" id="games-count">0</span>
                        </div>
                        <div class="profile-stat">
                            <span>ì´ í”Œë ˆì´ ì‹œê°„</span>
                            <span class="stat-value" id="total-playtime">0ì‹œê°„</span>
                        </div>
                        <div class="profile-stat">
                            <span>ë„ì „ê³¼ì œ</span>
                            <span class="stat-value" id="achievements-count">0</span>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="cards-grid">
                <div class="card">
                    <div class="card-header">ê°€ì¥ ë§ì´ í”Œë ˆì´í•œ ê²Œì„</div>
                    <div class="card-content" id="most-played-games">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ê²Œì„ ì•„ì´í…œ -->
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">ìµœê·¼ í”Œë ˆì´í•œ ê²Œì„</div>
                    <div class="card-content" id="recently-played-games">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ê²Œì„ ì•„ì´í…œ -->
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">ê°€ì¥ ì˜¤ë˜ëœ ë„ì „ê³¼ì œ</div>
                    <div class="card-content" id="oldest-achievements">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ë„ì „ê³¼ì œ ì•„ì´í…œ -->
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">ìµœê·¼ ë‹¬ì„±í•œ ë„ì „ê³¼ì œ</div>
                    <div class="card-content" id="recent-achievements">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ë„ì „ê³¼ì œ ì•„ì´í…œ -->
                    </div>
                </div>

                <!-- 1. í˜„ì¬ê¹Œì§€ ì‚¬ìš©í•œ ê¸ˆì•¡ ì¹´ë“œ -->
                <div class="card">
                    <div class="card-header">ğŸ’° ì´ ì§€ì¶œ ê¸ˆì•¡</div>
                    <div class="card-content">
                        <div class="total-amount">
                            <span class="amount-label">ì´ ì§€ì¶œ</span>
                            <span class="amount-value" id="total-spent">â‚©0</span>
                        </div>
                        <div class="expensive-games" id="expensive-games">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ë¹„ì‹¼ ê²Œì„ ëª©ë¡ -->
                        </div>
                    </div>
                </div>

                <!-- 2. ì‚¬ë†“ê³  ì•ˆí•œ ê²Œì„ ì¹´ë“œ -->
                <div class="card">
                    <div class="card-header">ğŸ˜´ ì‚¬ë†“ê³  ì•ˆí•œ ê²Œì„</div>
                    <div class="card-content">
                        <div class="total-amount">
                            <span class="amount-label">ë‚­ë¹„í•œ ê¸ˆì•¡</span>
                            <span class="amount-value waste-amount" id="wasted-amount">â‚©0</span>
                        </div>
                        <div class="unplayed-games" id="unplayed-games">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ë¯¸í”Œë ˆì´ ê²Œì„ ëª©ë¡(30ë¶„ ë¯¸ë§Œ í”Œë ˆì´) -->
                        </div>
                    </div>
                </div>

                <!-- 3. ë½• ë½‘ì€ ê²Œì„ ì¹´ë“œ -->
                <div class="card">
                    <div class="card-header">ğŸ¯ ë½• ë½‘ì€ ê²Œì„</div>
                    <div class="card-content" id="value-games">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ê°€ì„±ë¹„ ê²Œì„ ëª©ë¡ -->ã„´
                    </div>
                </div>

                <!-- 4. ë„ì „ê³¼ì œ ì™„ë£Œ ë¹„ìœ¨ì´ ë†’ì€ ê²Œì„ ì¹´ë“œ -->
                <div class="card">
                    <div class="card-header">ğŸ† ë„ì „ê³¼ì œ ë§ˆìŠ¤í„°</div>
                    <div class="card-content" id="achievement-games">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ë„ì „ê³¼ì œ ì™„ë£Œìœ¨ ë†’ì€ ê²Œì„ ëª©ë¡ -->
                        
                    </div>
                </div>

            </div>
        </div>

        <!-- ####################################################################################################### -->
        <!-- API í‚¤ ë³€ê²½ ëª¨ë‹¬ html ì…ë‹ˆë‹¤ -->
        <!-- ####################################################################################################### -->
        
        <!-- ì¢Œì¸¡ ìƒë‹¨ í†±ë‹ˆë°”í€´ ì•„ì´ì½˜ í´ë¦­ì‹œ ë‚˜íƒ€ë‚˜ëŠ” ëª¨ë‹¬ ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤-->
        <!-- ê´€ë ¨ í•¨ìˆ˜(í´ë¦­ ì´ë²¤íŠ¸)ëŠ” ë³¸ html ìë°” ìŠ¤í¬ë¦½íŠ¸ ìµœí•˜ë‹¨ì— ìˆìŠµë‹ˆë‹¤-->
        <div id="apiKeyModal" class="modal-overlay">
            <div class="api-key-card">
                <div class="modal-card-header">
                    <div class="card-title">
                        API í‚¤ ì„¤ì •
                    </div>
                    <button class="close-btn" onclick="closeApiKeyModal()">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                    </button>
                </div>

                <div id="messageContainer" class="message"></div>

                <form id="apiKeyForm">
                    <div class="form-group">
                        <label for="apiKeyInput" class="form-label">API í‚¤</label>
                        <div class="input-wrapper">
                            <input 
                                type="password" 
                                id="apiKeyInput" 
                                class="form-input" 
                                placeholder="XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
                                autocomplete="off"
                            >
                            <button type="button" class="toggle-visibility" onclick="togglePasswordVisibility()">
                                <svg id="eyeIcon" width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="button-row">
                        <button type="button" class="btn btn-secondary" onclick="closeApiKeyModal()">
                            ì·¨ì†Œ
                        </button>
                        <button type="submit" class="btn btn-primary" id="saveBtn">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
                            </svg>
                            ì €ì¥
                        </button>
                    </div>
                </form>
            </div>
        </div>


    </main>

    <footer class="footer">
        <p>Â© 2025 Steam í”„ë¡œí•„ ë·°ì–´ - 2233056 ì´ì„ ìš°</p>
        <p>ì´ í˜ì´ì§€ëŠ” Steam Web APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤. Valve Corporationê³¼ ì§ì ‘ì ì¸ ê´€ë ¨ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    </footer>

    <script>
        
        let apiKey = null

        // DOM ìš”ì†Œ
        // ë¬¸ì„œ ê°ì²´ë“¤ì„ ì „ì—­ì— í• ë‹¹í•˜ì—¬ í•¨ìˆ˜ë‚´ì—ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤
        const searchForm = document.getElementById('search-form');
        const steamIdInput = document.getElementById('steam-id');
        const loadingElement = document.getElementById('loading');
        const errorMessage = document.getElementById('error-message');
        const message = document.getElementById('message')
        const resultsContainer = document.getElementById('results-container');
        const profileAvatar = document.getElementById('profile-avatar');
        const profileName = document.getElementById('profile-name');
        const gamesCount = document.getElementById('games-count');
        const totalPlaytime = document.getElementById('total-playtime');
        const achievementsCount = document.getElementById('achievements-count');

        const mostPlayedGames = document.getElementById('most-played-games');
        const recentlyPlayedGames = document.getElementById('recently-played-games');
        const oldestAchievements = document.getElementById('oldest-achievements');
        const recentAchievements = document.getElementById('recent-achievements');

        const totalSpent = document.getElementById("total-spent");
        const expensiveGames = document.getElementById("expensive-games");

        const wastedAmount = document.getElementById("wasted-amount");
        const unplayedGames = document.getElementById("unplayed-games");

        const valueGames = document.getElementById("value-games");
        const achievementGames = document.getElementById("achievement-games");


        // í¼ ì œì¶œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        // ê²€ìƒ‰ Form ì˜ì—­ì˜ ê²€ìƒ‰ë²„íŠ¼(submit, ì œì¶œ) ì‹œ í•¨ìˆ˜ì…ë‹ˆë‹¤
        // preventDefaultë¥¼ ì‚¬ìš©í•˜ì—¬ ë°”ë¡œ http ìš”ì²­ì´ ì•„ë‹Œ ë‹¤ë¥¸ í•¨ìˆ˜ í˜¸ì¶œ í›„
        // í•´ë‹¹ í•¨ìˆ˜ë‚´ì—ì„œ fetchë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤
        searchForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const steamId = steamIdInput.value.trim();
            
            if (steamId) {
                // UI ì´ˆê¸°í™”, ì´ì „ ìš”ì²­ì˜ ì •ë³´ë“¤ì´ ë‚¨ì„ ìˆ˜ ìˆê¸°ì— íŠ¹ì • DOM ê°ì²´ì˜ ë‚´ìš© ë° displayìš”ì†Œë¥¼ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
                resetUI();
                
                // ë¡œë”© í‘œì‹œ
                loadingElement.style.display = 'block';
                
                // ì‹¤ì œ ìš”ì²­í•  í•¨ìˆ˜
                fetchData(steamId)
            }
        });

        // UI ì´ˆê¸°í™” í•¨ìˆ˜
        function resetUI() {
            // div ë°•ìŠ¤ë“¤ì„ ê°ì¶¥ë‹ˆë‹¤
            message.style.display = 'none'
            errorMessage.style.display = 'none';
            resultsContainer.style.display = 'none';

            // ë™ì ì¹´ë“œ ì˜ì—­ì˜ ë‚´ìš©ì„ ë¹„ì›ë‹ˆë‹¤
            mostPlayedGames.innerHTML = '';
            recentlyPlayedGames.innerHTML = '';
            oldestAchievements.innerHTML = '';
            recentAchievements.innerHTML = '';

            totalSpent.innerHTML = '';
            expensiveGames.innerHTML = '';

            wastedAmount.innerHTML = '';
            unplayedGames.innerHTML = '';

            valueGames.innerHTML = '';
            achievementGames.innerHTML = '';
        }

        // --------------------------- ì—¬ê¸°ì„œ ë¶€í„° ë°ì´í„° ì²˜ë¦¬ í•¨ìˆ˜ ì…ë‹ˆë‹¤ -------------------------------
        
        // ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ë°ì´í„° ì²˜ë¦¬ í•¨ìˆ˜ì˜ êµ¬ì„±ì€ íŠ¹ì • ë°ì´í„°ë¥¼ ë°›ì•„ì„œ
        // íŠ¹ì • ê¸°ì¤€(callbackí•¨ìˆ˜ë¡œ í˜¸ì¶œì‹œ ê¸°ì¤€ì„ ì •ì˜)ìœ¼ë¡œ ì •ë ¬ì„ í•œ í›„ ìƒìœ„ 3ê°œë¥¼ í˜•ì‹ì— ë§ê²Œ ë½‘ì•„ë‚´ëŠ” ì‹ì…ë‹ˆë‹¤
        
        // ìƒìœ„ 3ê°œì˜ ê²Œì„ì„ ì •ë ¬í•©ë‹ˆë‹¤. ì½œë°±í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ ê¸°ì¤€ìœ¼ë¡œ í•  ê°’
        // filterì˜ ê²½ìš° 'í”Œë ˆì´ í•˜ì§€ ì•Šì€ ê²Œì„'ì—ì„œ ë°–ì— ì‚¬ìš©í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—
        // ê¸°ë³¸ê°’ì„ ë”°ë¡œ ë‘ì—ˆìŠµë‹ˆë‹¤(ì¶”í›„ ì¶”ê°€í•œ ì¹´ë“œì´ê¸° ë•Œë¬¸ì— ê¸°ì¡´ê²ƒì„ ìˆ˜ì •í•˜ì§€ ì•Šê¸° ìœ„í•¨)
        function getTop3WithSorting_game(games, callback, data, filter=(e)=>e) {
            //console.log(games)

            // ìš°ì„  ë°”ë¡œ í•„í„° ì ìš©ì„ í•©ë‹ˆë‹¤ ê·¸ í›„ ì •ë ¬ì„ í•©ë‹ˆë‹¤, ì •ë ¬ ê¸°ì¤€ì€ ì½œë°±í•¨ìˆ˜ë¡œ ì •í•©ë‹ˆë‹¤
            // ê·¸ í›„ sliceë¡œ ìƒìœ„ 3ê°œ, map ë©”ì„œë“œë¥¼ í†µí•´ gameElement(ì»¤ìŠ¤í…€ìœ¼ë¡œ ë§Œë“  ìƒì„±ì í•¨ìˆ˜)ì— ë„˜ê¸¸ìˆ˜ìˆëŠ” ê°’ìœ¼ë¡œ ë§Œë“¦ë‹ˆë‹¤
            // ê²°êµ­ ìµœì¢… ë¦¬í„´ì€ ê·¸ëŸ¬í•œ í˜•ì‹ì´ 3ê°œ ë“¤ì–´ê°„ ë°°ì—´ì…ë‹ˆë‹¤
            return games.filter(filter).sort( 
                (a,b)=> callback(b) - callback(a) 
            ).slice(0, 3
            ).map((item)=>{
                const gameData = {
                    name: item.name,
                    data: data(item),
                    image: `https://media.steampowered.com/steamcommunity/public/images/apps/${item.appid}/${item.img_icon_url}.jpg`
                }
                return gameData
            })
        }

        // ìœ„ì™€ ê°™ì§€ë§Œ ë„ì „ê³¼ì œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•©ë‹ˆë‹¤
        // ë§ˆì§€ë§‰ ì¹´ë“œ(ë„ì „ê³¼ì œ ë§ˆìŠ¤í„°) ì—ì„œë§Œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë”°ë¡œ ì½œë°±í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ í•˜ì§„ ì•Šì•˜ìŠµë‹ˆë‹¤
        function getTop3WithSorting_game_with_achievements(games, playerAchi) {
            // Object.keysì˜ ê²½ìš° ê°ì²´ì˜ í‚¤ê°’ì„ ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ ë§Œë“¤ì–´ì„œ ë¦¬í„´í•©ë‹ˆë‹¤
            // ê·¸ê²ƒë“¤ì¤‘ achievements ìš”ì†Œê°€ ìˆëŠ”(ë„ì „ê³¼ì œê°€ ì—†ëŠ” ê²Œì„ì´ ìˆìŠµë‹ˆë‹¤) keyë§Œ ë‚¨ê¹ë‹ˆë‹¤
            const clearRate = Object.keys(playerAchi                
            ).filter((key)=> playerAchi[key].playerstats.achievements && playerAchi[key].playerstats.achievements.length > 10
            ).map( key=>{ // í•„í„°í•œ key ê°’ì„ í†µí•´ playerAchi(ê²Œì„ë³„ ì‚¬ìš©ìì˜ ë„ì „ê³¼ì œ ì •ë³´)
                          // ì— ì ‘ê·¼í•˜ì—¬ ì „ì²´ ë„ì „ê³¼ì œ í´ë¦¬ì–´í•œ ë„ì „ê³¼ì œë¥¼ í•˜ë‚˜ì˜ ê°ì²´ë¡œ ë¬¶ì–´ì„œ ë¦¬í„´í•©ë‹ˆë‹¤
                let achieved = 0
                let total = playerAchi[key].playerstats.achievements.length

                // playerAchi[key].playerstats.achievementsì—ëŠ” í•´ë‹¹ ê²Œì„ì˜
                // ë„ì „ê³¼ì œ ëª©ë¡ê³¼ í´ë¦¬ì–´ ì •ë³´ê°€ ë“¤ì–´ê°€ìˆìŠµë‹ˆë‹¤ ê·¸ê±¸ ìˆœíšŒí•˜ë©´ì„œ achievedì— ì¹´ìš´íŠ¸í•©ë‹ˆë‹¤ 
                playerAchi[key].playerstats.achievements.forEach(achievement=>{
                    if (achievement.achieved) { achieved += 1 }
                })
                // ê·¸ ë‹¤ìŒ ê·¸ê±¸ í•˜ë‚˜ì˜ ê°ì²´ë¡œ ë§Œë“¤ì–´ ë¦¬í„´í•©ë‹ˆë‹¤. í˜„ì¬ê¹Œì§€ëŠ” ë°°ì—´ì† ê°ì²´ê°€ ìˆëŠ” ì´ì¤‘êµ¬ì¡°ì…ë‹ˆë‹¤
                return {
                    appid: key,
                    total: total,
                    achievedCount: achieved
                } // ì´ì¤‘êµ¬ì¡°ë¥¼ í•˜ë‚˜ì˜ ê°ì²´ë¡œ(keyë¡œ ì ‘ê·¼í•˜ê¸° ì‰½ë„ë¡)
                  // ë§Œë“¤ê¸° ìœ„í•´ flatMapê³¼ reduceë¡œ í•˜ë‚˜ì˜ ê°ì²´(appidë¥¼ í‚¤ë¡œ ê°€ì§€ëŠ”)ë¡œ ë§Œë“¦ë‹ˆë‹¤
            }).flatMap(item=> [[item.appid, {total:item.total, achievedCount: item.achievedCount}]]                
            ).reduce((acc, [key, obj])=> ({...acc, [key]: obj}))


            //console.log(clearRate);
            // ìµœì¢… ë¦¬í„´í•  ë¦¬ìŠ¤íŠ¸ ì…ë‹ˆë‹¤
            return games.filter((item)=>{
                // ìœ„ì˜ clearRate(ë„ì „ê³¼ì œ í´ë¦¬ì–´ë¥  ë¦¬ìŠ¤íŠ¸)ì— ì—†ëŠ” ê²Œì„(ë„ì „ê³¼ì œê°€ ì—†ëŠ” ê²Œì„)
                // ì˜ ê²½ìš° ì •ë ¬ì´ ë¶ˆê°€í•˜ê¸° ë•Œë¬¸ì— í•„í„°ë¡œ ê±¸ëŸ¬ëƒ…ë‹ˆë‹¤
                return clearRate[item.appid]
            }).sort( 
                // ì •ë ¬ ê¸°ì¤€ì—ì„œ ìœ„ì—ì„œ ë§Œë“  ë¦¬ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤ ê·¸ í›„ëŠ” ë‹¤ë¥¸ í•¨ìˆ˜ì™€ ê°™ìŠµë‹ˆë‹¤
                (a,b)=> {
                    item1 = clearRate[a.appid].achievedCount / clearRate[a.appid].total
                    item2 = clearRate[b.appid].achievedCount / clearRate[b.appid].total
                    return item2 - item1
                }
            ).slice(0, 3
            ).map((item)=>{
                const gameData = {
                    name: item.name,
                    data: [clearRate[item.appid].achievedCount, clearRate[item.appid].total],
                    image: `https://media.steampowered.com/steamcommunity/public/images/apps/${item.appid}/${item.img_icon_url}.jpg`
                }
                return gameData
            })
        }


        // ë„ì „ê³¼ì œë¥¼ ì •ë ¬í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
        // ë„ì „ê³¼ì œ ë°ì´í„°ì˜ êµ¬ì¡°ê°€ ì´ì¤‘ ê°ì²´{í‚¤ê°’:{},í‚¤ê°’:{},í‚¤ê°’:{}} 
        // ì—¬ê¸°ì„œ í‚¤ê°’ì€ ê²Œì„ì½”ë“œì´ë©° ê° ê²Œì„ë³„ë¡œ ë„ì „ê³¼ì œê°€ ëª¨ì—¬ìˆìŠµë‹ˆë‹¤
        // ëª¨ë“  ë„ì „ê³¼ì œë¥¼ ê°™ì´ ì •ë ¬í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— flatMapìœ¼ë¡œ í•˜ë‚˜ì˜ ë°°ì—´ì— ë¬¶ìŠµë‹ˆë‹¤ 
        function getTop3WithSorting_achievements(playerAchi, achievements, callback) {
            return Object.keys(playerAchi 
            ).filter( (key)=> playerAchi[key].playerstats.achievements 
            ).flatMap(key => {
                return playerAchi[key].playerstats.achievements.map(item => ({...item, appid:key })) 
            } 
            ).filter( item => item.unlocktime != 0 // í´ë¦¬ì–´í•˜ì§€ ì•Šì€ ë„ì „ê³¼ì œëŠ” í•„í„°ë¡œ ì œê±°í•©ë‹ˆë‹¤
            ).sort( // ë„ì „ê³¼ì œ ì •ë ¬ ì½œë°± í•¨ìˆ˜ë¡œ ê¸°ì¤€ì„ í˜¸ì¶œì‹œ ì •í•©ë‹ˆë‹¤
                (a,b)=> callback(b) - callback(a)
            ).slice(0,3
            ).map((item)=>{
                const key = item.appid
                const achiInfo = achievements[key].game.availableGameStats.achievements.filter(
                    e => e.name == item.apiname  
                )[0]
                //console.log(achiInfo)

                // ë„ì „ê³¼ì œ ë¬¸ì„œ ê°ì²´ ìƒì„± í•¨ìˆ˜ì— ë„˜ê¸¸ í˜•ì‹ìœ¼ë¡œ ë§Œë“¤ì–´ì„œ ë¦¬í„´í•©ë‹ˆë‹¤
                const achiData = {
                    name: achiInfo.displayName,
                    game: playerAchi[key].playerstats.gameName,
                    date: item.unlocktime,
                    image: achiInfo.icon
                } 
                //console.log(achiData)
                return achiData
            })
        }

        // ê²Œì„ ê°€ê²©ì„ ì§‘ê³„í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤ reduce í•¨ìˆ˜ë¥¼ ê³¼ì œ ì¤‘í›„ë°˜ì— ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤
        // í•œë²ˆ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜ì´ê¸°ì— êµ³ì´ í•¨ìˆ˜ë¡œ ë‘ì§€ ì•Šê³  reduce ì‚¬ìš©í•˜ì—¬ ë°”ë¡œ
        // ë°ì´í„° ê°ì²´ ë„£ì—ˆì–´ë„ ê´œì°®ì•˜ì„ê²ƒ ê°™ìŠµë‹ˆë‹¤
        function sum_price(games) {
            let total_price = 0
            Object.keys(games
            ).filter( key=> games[key].data.price_overview
            ).map((key)=> games[key]
            ).forEach((item)=>{
                total_price += item.data.price_overview.initial
            })
            console.log(total_price)
            return parseInt(total_price/100)
        }

        // ê°€ê²©ì„ ì§‘ê³„í•©ë‹ˆë‹¤ë§Œ í”Œë ˆì´ íƒ€ì„ì´ 30ë¶„ ë¯¸ë§Œì¸ ê²Œì„ë§Œ ì§‘ê³„í•©ë‹ˆë‹¤
        function sum_price_unplayed(games) {
            let total_price = 0
            games.filter((game)=>game.price > 0 && game.playtime_forever < 30
            ).forEach(game=> { total_price += game.price })
            return parseInt(total_price/100)
        }
        
        // --------------------------- ì—¬ê¸° ê¹Œì§€ê°€ ë°ì´í„° ì²˜ë¦¬ í•¨ìˆ˜ ì…ë‹ˆë‹¤ -------------------------------

        // fetch(ë¹„ë™ê¸° ì²˜ë¦¬, Promiseê°€ ë°˜í™˜ë ìˆ˜ ìˆì–´ì•¼í•¨ ê·¸ë ‡ê¸°ì— async í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤ )
        async function fetchData(steamId) {
            // ë§¤ê²Œë³€ìˆ˜ë¡œ ë°›ì€ steamIdì™€ ì „ì—­ë³€ìˆ˜ apikeyë¥¼ ì¿¼ë¦¬ë¬¸ì— ë„£ì–´ì„œ ìš”ì²­í•©ë‹ˆë‹¤
            // í•´ë‹¹ê³¼ì œì—ì„œ ì‚¬ìš©í•œ open api(steam web api)ì™€ ë²¡ì—”ë“œì—ì„œ ë°›ëŠ” í†µì‹  ë©”ì„œë“œëŠ”
            // ì „ë¶€ GET ë©”ì„œë“œì…ë‹ˆë‹¤
            
            // try ë¬¸ì—ì„œ ìš”ì²­ì„ ë³´ë‚´ì„œ ë§Œì•½ express ì„œë²„ê°€ ì¼œì ¸ ìˆì§€ ì•Šì•„
            // fetchì˜ ì—”ë“œí¬ì¸íŠ¸ê°€ ì‘ë‹µì´ ì—†ì„ê²½ìš° ì˜ˆì™¸ì²˜ë¦¬ë¥¼ í•˜ì˜€ìŠµë‹ˆë‹¤
            // ë˜í•œ then ë©”ì„œë“œë¥¼ í†µí•´ Promise ìƒíƒœê°€ ëë‚¬ì„ë•Œ ì‘ë‹µì˜ statusë¥¼ ë³´ê³  ê·¸ì— ë§ëŠ”
            // ui ì²˜ë¦¬ë¥¼ í•˜ì˜€ìŠµë‹ˆë‹¤
            let res;
            try{
                res =  await fetch(`https://3.27.71.87.nip.io/api?steamId=${steamId}`+ (apiKey ? `&apiKey=${apiKey}` : ``)
                ).then((response)=>{
                    if (response.status === 403) {         
                        errorMessage.innerText = "í”„ë¡œí•„ ë¹„ê³µê°œ ê³„ì •ì…ë‹ˆë‹¤."
                        errorMessage.style.display = 'block';
                        loadingElement.style.display = 'none';
                        throw new Error("stop")
                    }
                    else if (response.status == 400) { 
                        errorMessage.innerText = "ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. Steam ì‚¬ìš©ìëª…ì´ ì•„ë‹Œ Steam ID(ê³ ìœ  17ìë¦¬)ë¥¼ ì…ë ¥í•˜ì—¬ ì£¼ì„¸ìš”."
                        errorMessage.style.display = 'block';
                        loadingElement.style.display = 'none';
                        throw new Error("stop")
                    }
                    else if (response.status == 429) {
                        errorMessage.innerText = "API ìš”ì²­ì´ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ì‹œë„í•˜ì—¬ ì£¼ì„¸ìš”"
                        errorMessage.style.display = 'block';
                        loadingElement.style.display = 'none';
                        throw new Error("stop")
                    }
                    else if (response.status == 500) {
                        errorMessage.innerText = "ì„œë²„ ì˜¤ë¥˜ì…ë‹ˆë‹¤"
                        errorMessage.style.display = 'block';
                        loadingElement.style.display = 'none';
                        throw new Error("stop")
                    }
                    return response
                });
            } catch(e) {
                // ì˜ˆì™¸ ì²˜ë¦¬ë¡œ fetchDataë¥¼ ë©ˆì¶”ê³  ì‹¶ì„ë• Error ê°ì²´ì˜ message í”„ë¡œí¼í‹°ë¥¼ stopìœ¼ë¡œ ì •í•´
                // êµ¬ë¶„ëœ ì—ëŸ¬ ê°ì²´ ì²˜ëŸ¼ ì‚¬ìš©í•˜ì—¬ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤
                if (e.message == "stop") { return }
                errorMessage.innerText = "ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”."
                errorMessage.style.display = 'block';
                loadingElement.style.display = 'none';
            }

            // ìœ„ì˜ ê²€ì‚¬ë¥¼ í†µí•´ ì‘ë‹µì´ ì˜ ì™”ìœ¼ë©´ jsonì„ ë°˜í™˜ ë°›ìŠµë‹ˆë‹¤
            const body = await res.json()

            // ì´ì œ bodyì˜ ë‚´ìš©ë“¤ì„ ê°ê°ì˜ ë³€ìˆ˜ì— í’‰ë‹ˆë‹¤
            const PlayerInfo = body.PlayerInfo;
            const games = body.games;
            const playerAchievements = body.playerAchievements; 
            const OwnedGames = body.OwnedGames;
            const achievements = body.achievements

            // ì‚¬ìš©ìê°€ í”„ë¡œí•„ì„ ì¼ë¶€ë¶„ ë¹„ê³µê°œ í•˜ê±°ë‚˜
            // ìì‹ ì˜ apií‚¤ë¡œ ìì‹ ì˜ ê³„ì •ì„ ê²€ìƒ‰í• ë•ŒëŠ” ë” ë§ì€ ì •ë³´ê°€ ë‚˜ì˜¤ê¸° ë•Œë¬¸ì—
            // ê°€ëŠ¥í•œ ì„±ê³µí•œ ëª¨ë“  ì •ë³´ë¥¼ ë„ìš°ê³ ì ë¶ˆë¦¬ì•ˆ ê°’ìœ¼ë¡œ ì •ë³´ì˜ ì ‘ê·¼ ìƒíƒœë¥¼ ë³€ìˆ˜ë¡œ ê´€ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤
            const achi_isNotPublic = !playerAchievements
            const last_played_isNotPublic = !(OwnedGames.games[0]?.rtime_last_played)

            /* ê³¼ì œë¥¼ í•˜ë©° ê³„ì†í•´ì„œ ì‘ë‹µì˜ ë‚´ìš©ë“¤ì„ ë´ê°€ë©´ì„œ ë°ì´í„°ë¥¼ ê°€ê³µí•´ì•¼ í–ˆê¸°ì—
                ì½˜ì†”ë¬¸ìœ¼ë¡œ ì¶œë ¥ë¬¸ì„ í™•ì¸í•´ê°€ë©° ì‘ì—…í–ˆìŠµë‹ˆë‹¤
                429 ì—ëŸ¬ ë¬¸ì œë¥¼ ì•Œê²Œëœí›„ì—” ë©”ëª¨ì¥ì— ì˜®ê²¨ì„œ í™•ì¸í•´ê°€ë©° ì‘ì—…í•˜ì˜€ìŠµë‹ˆë‹¤
            
            console.log(achievements)
            console.log(playerAchievements)
            console.log(games)
            console.log(OwnedGames)
            console.log(PlayerInfo)
            */

            // display í•¨ìˆ˜ì— ë„˜ê¸¸ data ê°ì²´ì…ë‹ˆë‹¤
            // ê° valueì˜ ê²½ìš° ì‘ë‹µì˜ ë‚´ìš©ì„ ê¸°ëŒ€ë¡œ ë„˜ê¸°ëŠ” ë°ì´í„°ë„ ìˆê³ 
            // ìœ„ì˜ ë°ì´í„° ì²˜ë¦¬ í•¨ìˆ˜ë“¤ì— ë„˜ê¸´ ë¦¬í„´ê°’ì„ ë„£ëŠ” ê²½ìš°ë„ ìˆìŠµë‹ˆë‹¤
            // ë³€ìˆ˜ë¥¼ ì ê²Œ ì“°ê³  ì‹¶ì–´ ë°”ë¡œ í•¨ìˆ˜ì˜ ë¦¬í„´ê°’(í‰ê°€ê°’)ì„ valueë¡œ ë„£ì—ˆìŠµë‹ˆë‹¤
            const data = {
                profile: {
                    name: PlayerInfo.personaname,
                    avatar: PlayerInfo.avatarfull,
                    gamesCount: OwnedGames.game_count,
                    // 206 ì—ëŸ¬ë¡œ ì¸í•´ ì‚¬ìš©ì ë„ì „ê³¼ì œ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ì—†ì„ ê²½ìš° í•´ë‹¹ ë°ì´í„°ë¥¼ nullë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤
                    achievementsCount: achi_isNotPublic ? null :
                    // ë§Œì•½ 206 ì—ëŸ¬ê°€ ì•„ë‹ ê²½ìš° ì•„ë˜ì˜ í‰ê°€ê°’ìœ¼ë¡œ ëŒ€ì²´
                    // íë¦„ì„ ìš”ì•½í•˜ìë©´ ì „ì²´ ë„ì „ê³¼ì œ(ê²Œì„ë³„ë¡œ ëª¨ì—¬ìˆìŒ)ì„ ìˆœíšŒí•˜ë©´ì„œ
                    // ê·¸ ì•ˆì—ì„œ í•´ë‹¹ ê²Œì„ì˜ ë„ì „ê³¼ì œ ëª©ë¡ì„ ìˆœíšŒí•˜ë©´ì„œ í´ë¦¬ì–´ë¥¼ ì¹´ìš´íŠ¸ í•©ë‹ˆë‹¤ 
                        Object.keys(playerAchievements).reduce((acc, key)=>{
                            if (! playerAchievements[key].playerstats.achievements) { return acc+0 }
                            cnt = 0
                            playerAchievements[key].playerstats.achievements.forEach(achi=>{
                                if (achi.achieved) { cnt ++ }
                            })
                            return acc+cnt // ì¹´ìš´íŠ¸í•œ ê°’(ê²Œì„ ë³„)ì„ ë‹¤ ë”í•´ì„œ í•˜ë‚˜ì˜ ì •ìˆ˜ê°’  
                        }, 0), // ë§ˆì§€ë§‰ ì¸ì 0ì˜ ê²½ìš° reduceì˜ ìµœì´ˆ ìˆœíšŒì‹œ accë¥¼ ì–´ë–¤ ê°’ìœ¼ë¡œ í• ê²ƒì¸ê°€ ì…ë‹ˆë‹¤
                        // reduceì˜ ë™ì‘ë°©ì‹ì´ ë§ˆì§€ë§‰ reduceì˜ ë¦¬í„´ê°’ì´ acc ë§¤ê²Œë³€ìˆ˜ì— ë„˜ê²¨ì§€ëŠ” ì‹ì´ê¸° ë•Œë¬¸ì— ì²«ë²ˆì¨°ì˜ ê²½ìš° ê°’ì„ ë”°ë¡œ ì§€ì •

                    totalPlaytime: parseInt((OwnedGames.games.reduce((acc, game)=>acc+game.playtime_forever, 0))/60)
                },
                mostPlayedGames: getTop3WithSorting_game(OwnedGames.games, (e)=> e.playtime_forever, (data) => parseInt(data.playtime_forever/60)),

                recentlyPlayedGames: last_played_isNotPublic ? null :
                    getTop3WithSorting_game(OwnedGames.games, (e)=> e.rtime_last_played, (data)=> parseInt(data.playtime_forever/60)),

                oldestAchievements: achi_isNotPublic ? null : 
                    getTop3WithSorting_achievements(playerAchievements, achievements, (e)=> -e.unlocktime),

                recentAchievements: achi_isNotPublic ? null : 
                    getTop3WithSorting_achievements(playerAchievements, achievements, (e)=> e.unlocktime),

                totalSpent: sum_price(games),

                expensiveGames: getTop3WithSorting_game(OwnedGames.games, (e)=> e.price, (data)=> parseInt(data.price/100)),

                valueGames: getTop3WithSorting_game(OwnedGames.games, (e)=> {
                    if (e.price == 0) {
                        return -99999999999
                    }
                    else {
                        return -(e.price/e.playtime_forever)
                    }
                }, (data)=> {
                    const price = parseInt(data.price/100);
                    const playTime = parseInt(data.playtime_forever/60)
                    console.log(price)
                    console.log(playTime)
                    return parseInt(price/playTime)
                }),

                wastedAmount: sum_price_unplayed(OwnedGames.games),
                
                unplayedGames: getTop3WithSorting_game(OwnedGames.games, (e)=> e.price, (data)=> parseInt(data.price/100), (game)=>game.playtime_forever < 30),
                
                achievementGames: achi_isNotPublic ? null : 
                    getTop3WithSorting_game_with_achievements(OwnedGames.games, playerAchievements)
            }

            // ë°ì´í„° í‘œì‹œì‹œí‚¤ëŠ” í•¨ìˆ˜ì— dataë¥¼ í†µì¨°ë¡œ ë„˜ê¹ë‹ˆë‹¤ 
            displayData(data);
        }

        // ë°ì´í„° í‘œì‹œ í•¨ìˆ˜
        function displayData(data) {
            //console.log(data)
            // ë¡œë”© ìˆ¨ê¸°ê¸°
            loadingElement.style.display = 'none';
            
            // í”„ë¡œí•„ ì •ë³´ í‘œì‹œ
            profileAvatar.style.backgroundImage = `url(${data.profile.avatar})`;
            profileName.textContent = data.profile.name;
            gamesCount.textContent = data.profile.gamesCount;
            totalPlaytime.textContent = `${data.profile.totalPlaytime}ì‹œê°„`;
            
            // ê°€ì¥ ë§ì´ í”Œë ˆì´í•œ ê²Œì„
            data.mostPlayedGames.forEach(game => {
                const gameElement = createGameElement(game, (data)=> (data+"ì‹œê°„ í”Œë ˆì´"));
                mostPlayedGames.appendChild(gameElement);
            });
            
            // ì´ ì§€ì¶œ ì¹´ë“œ
            totalSpent.innerText = data.totalSpent.toLocaleString()+"ì›"
            data.expensiveGames.forEach(game => {
                const gameElement = createGameElement(game, (data)=> (data.toLocaleString()+"ì›"));
                expensiveGames.appendChild(gameElement);
            })

            // ì‚¬ë†“ê³  ì•ˆí•œê²Œì„
            wastedAmount.innerText = data.wastedAmount.toLocaleString()+"ì›"
            data.unplayedGames.forEach(game => {
                const gameElement = createGameElement(game, (data)=> (data.toLocaleString()+"ì›"));
                unplayedGames.appendChild(gameElement);
            })

            // ë½•ë½‘ì€ ê²Œì„
            data.valueGames.forEach(game => {
                const gameElement = createGameElement(game, (data)=> ("1ì‹œê°„ ë‹¹ ê°€ê²© "+data.toLocaleString()+"ì›"));
                valueGames.appendChild(gameElement);
            })

            // ì •ë³´ ê³µê°œ ì •ë„ì— ë”°ë¼ null ê°’ìœ¼ë¡œ ëŒ€ì²´ ëœê±¸ falsy í‰ê°€ê°’ìœ¼ë¡œ ì¡°ê±´ë¬¸ì— ì‹¤ì—ˆìŠµë‹ˆë‹¤ 
            if (data.profile.achievementsCount) {
                achievementsCount.parentElement.style.display = "flex";
                achievementsCount.textContent = data.profile.achievementsCount;
            } else { achievementsCount.parentElement.style.display = "none"; }

            if (data.recentlyPlayedGames) { 
                recentlyPlayedGames.parentElement.style.display = "block";
                data.recentlyPlayedGames.forEach(game => {
                    const gameElement = createGameElement(game, (data)=> (data+"ì‹œê°„ í”Œë ˆì´"));
                    recentlyPlayedGames.appendChild(gameElement);
                });
            } else { recentlyPlayedGames.parentElement.style.display = "none"; }

            if (data.oldestAchievements) {
                oldestAchievements.parentElement.style.display = "block";
                data.oldestAchievements.forEach(achievement => {
                    const achievementElement = createAchievementElement(achievement);
                    oldestAchievements.appendChild(achievementElement);
                });
            } else { oldestAchievements.parentElement.style.display = "none"; }

            if (data.recentAchievements) {
                recentAchievements.parentElement.style.display = "block";
                data.recentAchievements.forEach(achievement => {
                    const achievementElement = createAchievementElement(achievement);
                    recentAchievements.appendChild(achievementElement);
                });
            } else { recentAchievements.parentElement.style.display = "none"; }

            if (data.achievementGames) {
                achievementGames.parentElement.style.display = "block";
                data.achievementGames.forEach(game => {
                    const gameElement = createGameElement(game, (data)=> ("ë„ì „ê³¼ì œ í´ë¦¬ì–´ "+data[0]+"/"+data[1]));
                    achievementGames.appendChild(gameElement);
                });
            } else { achievementGames.parentElement.style.display = "none"; }
            
            resultsContainer.style.display = 'block';
        }
        
        // ê²Œì„ ìš”ì†Œ ìƒì„± í•¨ìˆ˜
        // document.createElement ì²˜ëŸ¼ ì‘ë™í•˜ëŠ” ì»¤ìŠ¤í…€ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤
        function createGameElement(game, how_display) {
            const gameElement = document.createElement('div');
            gameElement.className = 'game-item';
            
            // how_display ë§¤ê²Œë³€ìˆ˜(ì½œë°±í•¨ìˆ˜ì„)ë¥¼ í†µí•´ ê²Œì„ ì¹´ë“œì˜ ì„¸ë¶€ ì •ë³´ í¬ë§·íŒ…ì„ í˜¸ì¶œ ì‹œ ì§€ì •í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤
            gameElement.innerHTML = `
                <div class="game-image" style="background-image: url('${game.image}')"></div>
                <div class="game-details">
                    <div class="game-title">${game.name}</div>
                    <div class="game-stats">
                        <span class="hours-played">${how_display(game.data)}</span>
                    </div>
                </div>
            `;
            
            return gameElement;
        }

        // ë„ì „ê³¼ì œ ìš”ì†Œ ìƒì„± í•¨ìˆ˜
        // ì „ì²´ì ìœ¼ë¡œ ìœ„ì™€ ê°™ì§€ë§Œ ë‚ ì§œ í˜•ì‹ì„ ë³€í™˜í•´ì£¼ëŠ” í•¨ìˆ˜ë¥¼ í†µí•´ ë‚ ì§œ í¬ë§·íŒ…ì„ í•˜ì˜€ìŠµë‹ˆë‹¤
        function createAchievementElement(achievement) {
            const achievementElement = document.createElement('div');
            achievementElement.className = 'achievement';
            
            achievementElement.innerHTML = `
                <div class="achievement-icon" style="background-image: url('${achievement.image}')"></div>
                <div class="achievement-details">
                    <div class="achievement-title">${achievement.name}</div>
                    <div class="achievement-date">${achievement.game} â€¢ ${formatDate(achievement.date)}</div>
                </div>
            `;
            
            return achievementElement;
        }

        // ë‚ ì§œ í¬ë§· í•¨ìˆ˜
        function formatDate(dateString) {
            const date = new Date(dateString*1000);
            //console.log(date.getFullYear())
            return date.toLocaleString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' });
        }
        // ì—¬ê¸° ê¹Œì§€ê°€ ë©”ì¸ JSì…ë‹ˆë‹¤ ì•„ë˜ëŠ” ì¢Œì¸¡ ìƒë‹¨ì˜ API KEY ìˆ˜ë™ì…ë ¥ ëª¨ë‹¬ì„ ìœ„í•œ í•¨ìˆ˜ì…ë‹ˆë‹¤

        // API í‚¤ ëª¨ë‹¬ ì—´ê¸°
        function openApiKeyModal() {
            const modal = document.getElementById('apiKeyModal');
            const apiKeyInput = document.getElementById('apiKeyInput');
            
            // ì²˜ìŒ ëª¨ë‹¬ì°½ ë“±ì¥ì‹œ ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•´ active í´ë˜ìŠ¤ëª…ìœ¼ë¡œ css ë³€ê²½
            modal.classList.add('active');
            
            // í¬ì»¤ìŠ¤ë¥¼ API í‚¤ ì…ë ¥ í•„ë“œë¡œ ì´ë™
            setTimeout(() => {  
                apiKeyInput.focus();
            }, 100);
            
            // ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
            hideMessage();
        }

        // API í‚¤ ëª¨ë‹¬ ë‹«ê¸°
        function closeApiKeyModal() {
            const modal = document.getElementById('apiKeyModal');
            modal.classList.remove('active');
            hideMessage();
        }

        // ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ/ìˆ¨ê¹€ í† ê¸€
        //svgì˜ ê²½ìš° AI ìƒì„±ì„ í†µí•´ì„œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤
        function togglePasswordVisibility() {
            const input = document.getElementById('apiKeyInput');
            const eyeIcon = document.getElementById('eyeIcon');
            
            if (input.type === 'password') {
                input.type = 'text';
                eyeIcon.innerHTML = `
                    <path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>
                `;
            } else {
                input.type = 'password';
                eyeIcon.innerHTML = `
                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                `;
            }
        }

        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(text, type = 'success') {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = text;
            messageContainer.className = `message ${type} show`;
        }

        // ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
        function hideMessage() {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.classList.remove('show');
        }

        // API í‚¤ ì €ì¥
        function saveApiKey() {
            // api í‚¤ ì…ë ¥ ìš”ì†Œì˜ ê°’ì„ ê³µë°± ì—†ì´ ë°›ìŠµë‹ˆë‹¤
            const apiKey_byInput = document.getElementById('apiKeyInput').value.trim();
            const saveBtn = document.getElementById('saveBtn');
            
            // ë‚´ìš©ì´ ë¹„ì—ˆë‹¤ë©´ ì˜¤ë¥˜ ë©”ì„¸ì§€ í‘œì‹œì™€ í•¨ê»˜ í•¨ìˆ˜ì¢…ë£Œ
            if (!apiKey_byInput) {
                showMessage('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            // ê°„ë‹¨í•œ API í‚¤ í˜•ì‹ ê²€ì¦
            if (apiKey_byInput.length < 10) {
                showMessage('ìœ íš¨í•˜ì§€ ì•Šì€ API í‚¤ í˜•ì‹ì…ë‹ˆë‹¤.', 'error');
                return;
            }

            // ì €ì¥ ë²„íŠ¼ ë¹„í™œì„±í™”
            saveBtn.disabled = true;
            saveBtn.innerHTML = `
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24" style="animation: spin 1s linear infinite;">
                    <path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/>
                </svg>
                ì €ì¥ ì¤‘...
            `;

            // express í”„ë¡ì‹œ ì„œë²„ì— ì—”ë“œí¬ì¸íŠ¸ë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ì„œ steam web apiì— ìš”ì²­ í•˜ë‚˜ë¥¼ ì´ì„œ
            // api keyê°€ ìœ ìš”í•œì§€ í™•ì¸í•˜ê³  ìœ íš¨ í•  ê²½ìš°ì—ë§Œ ì „ì—­ ë³€ìˆ˜ apiKeyì— ë„£ìŠµë‹ˆë‹¤
            setTimeout(async ()=> {
                try {
                    const res = await fetch(`https://3.27.71.87.nip.io/api/status?apiKey=${apiKey_byInput}`)

                    if (res.ok) {
                        apiKey = apiKey_byInput
                        showMessage('API í‚¤ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    }
                    else if (res.status == 429) {
                        showMessage('í•´ë‹¹ API KEYê°€ ì´ë¯¸ ë„ˆë¬´ ë§ì€ ìš”ì²­ì„ ìˆ˜í–‰í•˜ì˜€ìŠµë‹ˆë‹¤. ì ì‹œí›„ ë‹¤ì‹œ ì‹œë„í•˜ì—¬ì£¼ì„¸ìš”.', 'error')
                    }
                    else {
                        showMessage('ìœ íš¨í•˜ì§€ ì•Šì€ API í‚¤ì…ë‹ˆë‹¤. API í‚¤ë¥¼ í•œë²ˆ ë” í™•ì¸í•˜ì—¬ ì£¼ì„¸ìš”.', 'error')
                    }
                } catch (error) {
                    showMessage('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                } finally {
                    // ì €ì¥ ë²„íŠ¼ ë³µì›
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = `
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
                        </svg>
                        ì €ì¥
                    `;
                }
            }, 1000);
            
        }

        // ëª¨ë‹¬ì˜ ì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆì— í•¨ìˆ˜ ì—°ê²°, í•¨ìˆ˜ë¡œ ì—°ê²°í•˜ê¸° ìœ„í•´ preventDefault ì‚¬ìš© 
        document.getElementById('apiKeyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveApiKey();
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('apiKeyModal').addEventListener('click', function(e) {
            if (e.target === this) { 
                closeApiKeyModal();
            }
        });

        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modal = document.getElementById('apiKeyModal');
                if (modal.classList.contains('active')) {
                    closeApiKeyModal();
                }
            }
        });
        // server.jsì— open API í˜¸ì¶œ ì½”ë“œê°€ ìˆìŠµë‹ˆë‹¤ í™•ì¸í•˜ì—¬ ì£¼ì„¸ìš”
    </script>
</body>
</html>